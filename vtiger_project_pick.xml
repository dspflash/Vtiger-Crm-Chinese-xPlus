<WndTap Name="vtiger_project_pick" Text="vtiger_project_Pick">
<var name="searchtmpl"><projectname format="(v.projectname like '%%{opvalue}%')"/><projecttype format="v.projecttype='%{opvalue}'"/><projectstatus format="v.projectstatus='%{opvalue}'"/><startdate format="(v.startdate between '%{startdate[datetime]}' and '%{startdate[datetime2]}')"/><actualenddate format="(v.actualenddate between '%{actualenddate[datetime]}' and '%{actualenddate[datetime2]}')"/><projectpriority format="v.projectpriority='%{opvalue}'"/><project_no format="(v.project_no like '%%{opvalue}%')"/><responsible format="v.responsible='%{opvalue}'"/><linktoaccountscontacts format="v.linktoaccountscontacts='%{opvalue}'"/><referid format="v.referid='%{opvalue}'"/><projectid format="(v.projectid like '%%{opvalue}%')"/><release_by format="v.release_by='%{opvalue}'"/><release_date format="(v.release_date between '%{release_date[datetime]}' and '%{release_date[datetime2]}')"/><description format="(v.description like '%%{opvalue}%')"/><created_by format="v.created_by='%{opvalue}'"/><creation_date format="(v.creation_date between '%{creation_date[datetime]}' and '%{creation_date[datetime2]}')"/><last_update_by format="v.last_update_by='%{opvalue}'"/><last_update_date format="(v.last_update_date between '%{last_update_date[datetime]}' and '%{last_update_date[datetime2]}')"/><refertbl format="(v.refertbl like '%%{opvalue}%')"/></var>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="lan\vtiger_project.xml"/>
<Ctrls><GroupBox  Name="GBvtiger_project" id="vtiger_project" Text="vtiger_project" Size="100,100"><Ctrls>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="vtiger_project_Vs.xml"/>
<BR AutoHeight="1"/><GroupBox  Name="GBOPVvtiger_project" Size="100,20" cols="xs12 sm6 md4"><Ctrls>
<Button Text="reset" ToolTip="ttp_resetvtiger_project" Name="resetvtiger_project" Size="50,20">	<OnClick>	<submit next="GBDEDITvtiger_project" function="reset"/>	</OnClick>	</Button><TAB/>	
<Button Text="Search" ToolTip="ttp_gsearchvtiger_project" Name="gsearchvtiger_project" Size="50,20">	<OnClick>	
<search next="vtiger_project_vLst" listed="0" prefixwhere="0" prefixand="1" inputed="1">%{searchtmpl}</search><submit next="GBDEDITvtiger_project" namelist="search" function="search"/>	
</OnClick></Button><TAB/></Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox Name="GBDVvtiger_project" cols="xs12 sm12 md12 lg12"><Ctrls>
<ListCtrl Name="vtiger_project_vLst" ToolTip="ttp_vtiger_project_v" Size="700,450"        AutoSizeCol="0" Heading="project_no,100;responsible,120;accountname,150;projectname,150;productcode,100;imagename,100;customitem,100;productname,100;projectmilestonename,100;progress_memo,100;description,300;attachments,300;subject,120;projecttype,50;projectstatus,50;startdate,80;actualenddate,80;projectpriority,50;release_by,80;release_date,150;" loadedclick="0">
	<DbDetails >
<Index>projectid</Index>
<DbTable>vtigercrm6.vtiger_project v LEFT JOIN vtigercrm6.vtiger_projecttype v0 ON v.projecttype=v0.projecttypeid LEFT JOIN vtigercrm6.vtiger_projectstatus v1 ON v.projectstatus=v1.projectstatusid LEFT JOIN vtigercrm6.vtiger_projectpriority v2 ON v.projectpriority=v2.projectpriorityid LEFT JOIN vtigercrm6.vtiger_users v3 ON v.release_by=v3.id LEFT JOIN vtigercrm6.vtiger_users v4 ON v.created_by=v4.id LEFT JOIN vtigercrm6.vtiger_users v5 ON v.last_update_by=v5.id left join vtigercrm6.vtiger_account ac on v.linktoaccountscontacts=ac.accountid  left join vtigercrm6.users_v u on v.responsible=u.id LEFT JOIN vtigercrm6.vtiger_salesorder_item soi ON v.refertbl='salesorder_item' AND v.referid=soi.salesorder_itemid LEFT JOIN vtigercrm6.vtiger_salesorder so ON soi.salesorderid=so.salesorderid LEFT JOIN vtigercrm6.vtiger_projectmilestone pm ON v.projectid=pm.projectid AND !pm.reviewed LEFT JOIN (vtigercrm6.attachment a JOIN vtigercrm6.vtiger_projecttask pt ON a.reftbl='vtiger_projecttask' AND a.refid=pt.projecttaskid) ON pt.projectid=v.projectid AND pt.project_ms_idx=pm.project_ms_idx </DbTable>
<Data>v.projectname,v0.projecttype projecttype,v1.projectstatus projectstatus,v.startdate,v.actualenddate,v2.projectpriority projectpriority,v.project_no,u.fullname responsible,v3.accountname linktoaccountscontacts,v4.subject referid,v.projectid,v5.user_name release_by,v.release_date,v.description,v6.user_name created_by,v.creation_date,v7.user_name last_update_by,v.last_update_date,v.refertbl</Data>
<Order>projectid</Order></DbDetails>
<DbDetails><Data>v.project_no,u.fullname responsible,accountname linktoaccountscontacts,v.projectname,itemcode,itemimg,soi.customitem,itemname,MIN(pm.projectmilestonename) projectmilestonename,(SELECT GROUP_CONCAT(description SEPARATOR '; ') FROM vtigercrm6.attachment WHERE reftbl='vtiger_projectmilestone' AND refid=pm.projectmilestoneid) memo,GROUP_CONCAT(a.description SEPARATOR ';') description,GROUP_CONCAT(a.attachment SEPARATOR ';') attachments,so.subject,v0.projecttype projecttype,v1.projectstatus projectstatus,v.startdate,v.actualenddate,v2.projectpriority projectpriority,v3.user_name release_by,v.release_date,v4.user_name created_by,v.creation_date,v5.user_name last_update_by,v.last_update_date,v.projectid ,GROUP_CONCAT(a.location SEPARATOR ';') location,v1.projectstatusid</Data><Where>v.projectstatus&lt;6</Where><Queryformat>select %{data} from %{dbtable} where if(%{role_id}&gt;3,v.created_by='%{user_id}' or v.responsible='%{user_id}',1) and  %{where} GROUP BY projectid  ORDER BY projectid limit %{StartRow},%{PgSize}</Queryformat></DbDetails> <OnChanged><assign name="pagecur" expr="js(%{vtiger_project_vLst[currentpage]}+1)"/></OnChanged>f
<OnClick><if cond="%{vtiger_project_vLst[projectid]}"><DbDetails><Where>projectid='%{vtiger_project_vLst[projectid]}'</Where></DbDetails><submit namelist="DbDetails" next="$parent.%{frmwndctrl}"/><submit function="onok"/></if></OnClick>
</ListCtrl>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
</Ctrls></WndTap>
